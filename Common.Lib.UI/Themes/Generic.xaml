<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:primitives="clr-namespace:System.Windows.Controls.Primitives;assembly=PresentationFramework"
    xmlns:local="clr-namespace:Common.Lib.UI"
		xmlns:lconv="clr-namespace:Common.Lib.UI.Converters"
		xmlns:dlg="clr-namespace:Common.Lib.UI.Dialogs"
		xmlns:anim="clr-namespace:Common.Lib.UI.Animations"
	>
	<BitmapImage x:Key="closeImg" UriSource="Images/close-dark.png"/>
	<BitmapImage x:Key="restoreImg" UriSource="Images/restore-dark.png"/>
	<BitmapImage x:Key="minimizeImg" UriSource="Images/minimize-dark.png"/>
	<BitmapImage x:Key="maximizeImg" UriSource="Images/maximize-dark.png"/>
	<BitmapImage x:Key="deleteImg" UriSource="Images/delete.png"/>
	<BitmapImage x:Key="deleteFadedImg" UriSource="Images/delete-faded.png"/>
	<Style TargetType="{x:Type local:TitleBar}" x:Key="tbarDefaultStyle">
		<Setter Property="Background" Value="Black"/>
		<Setter Property="Foreground" Value="White"/>
		<Setter Property="FontSize" Value="16"/>
		<Setter Property="Title">
			<Setter.Value>
				<Binding Path="Title">
					<Binding.RelativeSource>
						<RelativeSource AncestorType="{x:Type local:AppWindow}" Mode="FindAncestor"/>
					</Binding.RelativeSource>
				</Binding>
			</Setter.Value>
		</Setter>
	</Style>
	<lconv:NullToVisibilityConverter x:Key="null2vis"/>
	<BooleanToVisibilityConverter x:Key="b2vc"/>
	<Style TargetType="{x:Type local:TitleBar}">
		<Style.Resources>
			<Style x:Key="btnStyle" TargetType="{x:Type primitives:ButtonBase}">
				<Setter Property="Width" Value="25"/>
				<Setter Property="Height" Value="25"/>
				<Setter Property="HorizontalAlignment" Value="Center"/>
				<Setter Property="HorizontalContentAlignment" Value="Center"/>
				<Setter Property="VerticalAlignment" Value="Center"/>
				<Setter Property="VerticalContentAlignment" Value="Center"/>
				<Setter Property="Margin" Value="2"/>
				<Setter Property="BorderThickness" Value="0"/>
				<Setter Property="BorderBrush" Value="Black"/>
			</Style>
			<local:WindowButtonTypeToVisibilityConverter x:Key="btConv"/>
			<local:WindowStateButtonTypeToVisibilityConverter x:Key="wsbtConv"/>
			<local:TitleBarTitleConverter x:Key="tbtc" />
			<Style TargetType="{x:Type local:TitleBar}" x:Key="defaultStyle">
				<Setter Property="Background" Value="Black"/>
				<Setter Property="Foreground" Value="White"/>
				<Setter Property="FontSize" Value="16"/>
				<Setter Property="Title">
					<Setter.Value>
						<Binding Path="Title">
							<Binding.RelativeSource>
								<RelativeSource AncestorType="{x:Type local:AppWindow}" Mode="FindAncestor"/>
							</Binding.RelativeSource>
						</Binding>
					</Setter.Value>
				</Setter>
				<Setter Property="ContentTemplate">
					<Setter.Value>
						<DataTemplate/>
						<!-- Empty value prevents ToString() renditions of DataContext-->
					</Setter.Value>
				</Setter>
			</Style>
		</Style.Resources>
		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="{x:Type local:TitleBar}">
					<Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}"
									Padding="{TemplateBinding Padding}" Margin="{TemplateBinding Margin}">
						<DockPanel LastChildFill="True">
							<Image Name="PART_Icon" DockPanel.Dock="Left" Source="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}},Path=Icon}"
										 Visibility="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}},Path=Icon,Converter={StaticResource null2vis}}"
										 MaxHeight="20" MaxWidth="20" Margin="4,2,2,2"/>
							<StackPanel Name="menu" VerticalAlignment="Center"/>
							<Button x:Name="PART_CloseButton" DockPanel.Dock="Right" 
											Style="{StaticResource btnStyle}"
											ToolTip="Close this window"
											Visibility="{Binding RelativeSource={RelativeSource AncestorType={x:Type local:TitleBar}},Path=ButtonTypes,Converter={StaticResource btConv},ConverterParameter=close}">
								<Image Source="{StaticResource closeImg}" Width="18" Height="18" Stretch="UniformToFill" StretchDirection="Both"/>
							</Button>
							<Button Name="PART_RestoreButton" DockPanel.Dock="Right" 
											Style="{StaticResource btnStyle}"
											ToolTip="Restore this window">
								<Button.Visibility>
									<MultiBinding Converter="{StaticResource wsbtConv}" ConverterParameter="restore">
										<Binding RelativeSource="{RelativeSource AncestorType={x:Type local:TitleBar}}" Path="ButtonTypes"/>
										<Binding RelativeSource="{RelativeSource AncestorType={x:Type Window}}" Path="WindowState"/>
									</MultiBinding>
								</Button.Visibility>
								<Image Source="{StaticResource restoreImg}"/>
							</Button>
							<Button Name="PART_MaximizeButton" DockPanel.Dock="Right"
											Style="{StaticResource btnStyle}"
											ToolTip="Maximize this window">
								<Button.Visibility>
									<MultiBinding Converter="{StaticResource wsbtConv}" ConverterParameter="maximize">
										<Binding RelativeSource="{RelativeSource AncestorType={x:Type local:TitleBar}}" Path="ButtonTypes"/>
										<Binding RelativeSource="{RelativeSource AncestorType={x:Type Window}}" Path="WindowState"/>
									</MultiBinding>
								</Button.Visibility>
								<Image Source="{StaticResource maximizeImg}"/>
							</Button>
							<Button Name="PART_MinimizeButton" DockPanel.Dock="Right"
											Style="{StaticResource btnStyle}"
											ToolTip="Minimize this window"
											Visibility="{Binding RelativeSource={RelativeSource AncestorType={x:Type local:TitleBar}},Path=ButtonTypes,Converter={StaticResource btConv},ConverterParameter=minimize}">
								<Image Source="{StaticResource minimizeImg}"/>
							</Button>
							<TextBlock Name="PART_Title" DockPanel.Dock="Left" VerticalAlignment="Center" Margin="4" 
												 Foreground="{TemplateBinding Foreground}" Style="{TemplateBinding TitleStyle}">
								<TextBlock.Text>
									<MultiBinding Converter="{StaticResource tbtc}">
										<Binding RelativeSource="{RelativeSource AncestorType={x:Type Window}}" Path="Title" />
										<Binding RelativeSource="{RelativeSource AncestorType={x:Type local:TitleBar}}" Path="Title"/>
									</MultiBinding>
								</TextBlock.Text>
							</TextBlock>
							<ContentControl Name="PART_ContentArea" ContentTemplate="{TemplateBinding ContentTemplate}"
															Content="{Binding}" DataContext="{x:Null}"/>
						</DockPanel>
					</Border>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>
	<Style TargetType="{x:Type local:AppWindow}">
		<Setter Property="WindowStyle" Value="None"/>
		<Setter Property="ResizeMode" Value="CanResizeWithGrip"/>
		<Setter Property="Content" Value="{Binding}"/>
		<Setter Property="SizeToContent" Value="Manual"/>
		<Setter Property="VerticalContentAlignment" Value="Stretch"/>
		<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
		<Setter Property="Background" Value="White"/>
		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="{x:Type local:AppWindow}">
					<AdornerDecorator>
						<Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
							<Grid Name="grid">
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="*"/>
								</Grid.RowDefinitions>
								<local:TitleBar Grid.Row="0" Style="{TemplateBinding TitleBarStyle}" x:Name="titleBar"
																Menu="{TemplateBinding Menu}"/>
								<ContentPresenter Grid.Row="1" Content="{TemplateBinding Content}" Name="content"/>
							</Grid>
						</Border>
					</AdornerDecorator>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>
	<Style TargetType="{x:Type dlg:DialogView}">
		<Style.Resources>
			<dlg:DialogButtonTypeToVisibilityConverter x:Key="dbt2vc"/>
			<DoubleAnimation x:Key="fadeIn" From="0.0" To="1.0" Duration="0:0:0.5"/>
			<DoubleAnimation x:Key="fadeOut" From="1.0" To="0.0" Duration="0:0:0.5"/>
		</Style.Resources>
		<Setter Property="Effect">
			<Setter.Value>
				<DropShadowEffect Opacity="0.7" Color="{Binding RelativeSource={RelativeSource AncestorType={x:Type dlg:DialogView}},Path=BorderBrush}"/>
			</Setter.Value>
		</Setter>
		<Setter Property="Template">
			<Setter.Value>
				<ControlTemplate TargetType="{x:Type dlg:DialogView}">
					<Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
						<Grid>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="*"/>
							</Grid.RowDefinitions>
							<DockPanel Grid.Row="0" Visibility="{TemplateBinding TitleVisibility}">
								<Border Background="{TemplateBinding TitleBackground}">
									<DockPanel>
										<StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
											<StackPanel.Resources>
												<Style TargetType="Button">
													<Setter Property="Width" Value="18"/>
													<Setter Property="Height" Value="18"/>
													<Setter Property="Background" Value="Black"/>
													<Setter Property="HorizontalContentAlignment" Value="Center"/>
													<Setter Property="VerticalContentAlignment" Value="Center"/>
													<Setter Property="HorizontalAlignment" Value="Center"/>
													<Setter Property="VerticalAlignment" Value="Center"/>
												</Style>
											</StackPanel.Resources>
											<Button Foreground="White" Name="restorer" ToolTip="Restore this popup"
															Visibility="{TemplateBinding DialogButtons,Converter={StaticResource dbt2vc},ConverterParameter=Restore}">
												<Image Source="{StaticResource restoreImg}"/>
											</Button>
											<Button Foreground="Red" Name="closer" ToolTip="Close this popup"
															Visibility="{TemplateBinding DialogButtons,Converter={StaticResource dbt2vc},ConverterParameter=Close}">
												<Image Source="{StaticResource closeImg}"/>
											</Button>
										</StackPanel>
										<ContentPresenter Margin="4" ContentSource="Header" RecognizesAccessKey="True"
																			TextBlock.Foreground="{TemplateBinding TitleForeground}"
																			TextBlock.FontWeight="Bold" TextBlock.FontStyle="Italic"/>
									</DockPanel>
								</Border>
							</DockPanel>
							<ContentPresenter Grid.Row="1" Margin="{TemplateBinding Padding}"/>
						</Grid>
					</Border>
				</ControlTemplate>
			</Setter.Value>
		</Setter>
	</Style>
</ResourceDictionary>
